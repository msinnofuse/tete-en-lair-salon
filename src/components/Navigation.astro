---
import { getTranslations, type Language } from '../i18n/utils';

export interface Props {
  currentLang?: Language;
}

const { currentLang = 'de' } = Astro.props;
const t = getTranslations(currentLang);

// Get current page for active menu item
const currentPath = Astro.url.pathname;
const getActiveClass = (path: string, isMobile: boolean = false) => {
  // Normalize paths for comparison (remove trailing slashes)
  const normalizedCurrentPath = currentPath.replace(/\/$/, '') || '/';
  const normalizedPath = path.replace(/\/$/, '') || '/';

  const isActive = normalizedCurrentPath === normalizedPath;
  if (!isActive) return '';
  return isMobile ? 'border-b-2 border-black' : 'border-b-2 border-white';
};
---

<nav class="fixed top-0 left-0 right-0 z-50 nav-modern">
  <div class="w-full relative">
    <div class="flex items-center h-24 pt-8">
      <!-- Desktop Navigation - Left Side -->
      <div class="hidden md:block absolute left-16 top-8 h-16 flex items-center">
        <div class="flex items-baseline space-x-4">
          <a href={currentLang === 'en' ? '/tete-en-lair-salon/en' : '/tete-en-lair-salon/'} class={`nav-link font-nav px-3 py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en' : '/tete-en-lair-salon/')}`} style="color: white; hover:color: var(--cream-white);" data-key="home">
            {t.nav.home}
          </a>
          <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/salon' : '/tete-en-lair-salon/salon'} class={`nav-link font-nav px-3 py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/salon' : '/tete-en-lair-salon/salon')}`} style="color: white; hover:color: var(--cream-white);" data-key="salon">
            {t.nav.salon}
          </a>
          <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/about' : '/tete-en-lair-salon/about'} class={`nav-link font-nav px-3 py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/about' : '/tete-en-lair-salon/about')}`} style="color: white; hover:color: var(--cream-white);" data-key="about">
            {t.nav.about}
          </a>
          <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/pricing' : '/tete-en-lair-salon/pricing'} class={`nav-link font-nav px-3 py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/pricing' : '/tete-en-lair-salon/pricing')}`} style="color: white; hover:color: var(--cream-white);" data-key="pricing">
            {t.nav.pricing}
          </a>
          <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/contact' : '/tete-en-lair-salon/contact'} class={`nav-link font-nav px-3 py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/contact' : '/tete-en-lair-salon/contact')}`} style="color: white; hover:color: var(--cream-white);" data-key="contact">
            {t.nav.contact}
          </a>
        </div>
      </div>

      <!-- Logo/Brand - Absolutely Centered -->
      <div class="w-full flex justify-center">
        <h1 class="text-4xl font-brand line-accent" style="color: white;">
          TÃŠTE EN L'AIR
        </h1>
      </div>

      <!-- Desktop Language Switcher & Mobile Menu Button - Right Side -->
      <div class="absolute right-16 top-8 h-16 flex items-center space-x-4">
        <!-- Desktop Language Switcher -->
        <div class="hidden md:flex language-switcher items-center space-x-2">
          <button
            class={`lang-btn px-3 py-1 text-xs font-nav transition-all rounded cursor-pointer ${currentLang === 'de' ? '' : 'hover:text-navy-blue'}`}
            style={currentLang === 'de' ? 'background: var(--navy-blue); color: var(--cream-white);' : 'color: white; background: transparent;'}
            data-lang="de"
          >
            DE
          </button>
          <span style="color: var(--powder-blue);">|</span>
          <button
            class={`lang-btn px-3 py-1 text-xs font-nav transition-all rounded cursor-pointer ${currentLang === 'en' ? '' : 'hover:text-navy-blue'}`}
            style={currentLang === 'en' ? 'background: var(--navy-blue); color: var(--cream-white);' : 'color: white; background: transparent;'}
            data-lang="en"
          >
            EN
          </button>
        </div>
      </div>

      <!-- Mobile Menu Button - Separate positioning -->
      <div class="md:hidden absolute right-8 top-8">
        <button
          id="mobile-menu-btn"
          type="button"
          class="inline-flex items-center justify-center p-3 transition-all focus:outline-none"
          style="color: white; hover:color: var(--cream-white);"
          aria-controls="mobile-menu"
          aria-expanded="false"
        >
          <span class="sr-only">Open main menu</span>
          <!-- Hamburger Icon -->
          <svg class="hamburger-icon block h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
          <!-- Close Icon -->
          <svg class="close-icon hidden h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="md:hidden hidden fixed inset-0 z-40 bg-white">
    <div class="flex flex-col items-center justify-center min-h-screen px-6 text-center space-y-8">
      <!-- Mobile Language Switcher -->
      <div class="mobile-language-switcher flex items-center justify-center space-x-4">
        <button
          class={`lang-btn px-6 py-3 text-lg font-nav transition-all rounded cursor-pointer ${currentLang === 'de' ? '' : 'hover:text-navy-blue'}`}
          style={currentLang === 'de' ? 'background: var(--navy-blue); color: var(--cream-white);' : 'color: var(--text-primary); background: transparent; border: 2px solid var(--text-primary);'}
          data-lang="de"
        >
          DE
        </button>
        <button
          class={`lang-btn px-6 py-3 text-lg font-nav transition-all rounded cursor-pointer ${currentLang === 'en' ? '' : 'hover:text-navy-blue'}`}
          style={currentLang === 'en' ? 'background: var(--navy-blue); color: var(--cream-white);' : 'color: var(--text-primary); background: transparent; border: 2px solid var(--text-primary);'}
          data-lang="en"
        >
          EN
        </button>
      </div>

      <!-- Navigation Links -->
      <nav class="space-y-3">
        <a href={currentLang === 'en' ? '/tete-en-lair-salon/en' : '/tete-en-lair-salon/'} class={`mobile-nav-link nav-link font-nav block text-2xl py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en' : '/tete-en-lair-salon/', true)}`} style="color: var(--text-primary); hover:color: var(--navy-blue);" data-key="home">
          {t.nav.home}
        </a>
        <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/salon' : '/tete-en-lair-salon/salon'} class={`mobile-nav-link nav-link font-nav block text-2xl py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/salon' : '/tete-en-lair-salon/salon', true)}`} style="color: var(--text-primary); hover:color: var(--navy-blue);" data-key="salon">
          {t.nav.salon}
        </a>
        <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/about' : '/tete-en-lair-salon/about'} class={`mobile-nav-link nav-link font-nav block text-2xl py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/about' : '/tete-en-lair-salon/about', true)}`} style="color: var(--text-primary); hover:color: var(--navy-blue);" data-key="about">
          {t.nav.about}
        </a>
        <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/pricing' : '/tete-en-lair-salon/pricing'} class={`mobile-nav-link nav-link font-nav block text-2xl py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/pricing' : '/tete-en-lair-salon/pricing', true)}`} style="color: var(--text-primary); hover:color: var(--navy-blue);" data-key="pricing">
          {t.nav.pricing}
        </a>
        <a href={currentLang === 'en' ? '/tete-en-lair-salon/en/contact' : '/tete-en-lair-salon/contact'} class={`mobile-nav-link nav-link font-nav block text-2xl py-2 transition-all ${getActiveClass(currentLang === 'en' ? '/tete-en-lair-salon/en/contact' : '/tete-en-lair-salon/contact', true)}`} style="color: var(--text-primary); hover:color: var(--navy-blue);" data-key="contact">
          {t.nav.contact}
        </a>
      </nav>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = mobileMenuBtn?.querySelector('.hamburger-icon');
  const closeIcon = mobileMenuBtn?.querySelector('.close-icon');

  mobileMenuBtn?.addEventListener('click', () => {
    const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
    
    mobileMenuBtn.setAttribute('aria-expanded', (!isExpanded).toString());
    mobileMenu?.classList.toggle('hidden');
    hamburgerIcon?.classList.toggle('hidden');
    hamburgerIcon?.classList.toggle('block');
    closeIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('block');
  });

  // Close mobile menu when clicking on nav links
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
  mobileNavLinks.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('hidden');
      mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      hamburgerIcon?.classList.add('block');
      hamburgerIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      closeIcon?.classList.remove('block');
    });
  });

  // Language switching functionality
  const langButtons = document.querySelectorAll('.lang-btn');
  
  langButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const selectedLang = btn.getAttribute('data-lang');
      const currentPath = window.location.pathname;
      
      // Extract the page name from the current path
      let pageName = '';
      if (currentPath.includes('/salon')) pageName = '/salon';
      else if (currentPath.includes('/about')) pageName = '/about';
      else if (currentPath.includes('/pricing')) pageName = '/pricing';
      else if (currentPath.includes('/contact')) pageName = '/contact';
      
      // Navigate to the appropriate page
      if (selectedLang === 'en') {
        window.location.href = '/tete-en-lair-salon/en' + pageName;
      } else {
        window.location.href = '/tete-en-lair-salon' + pageName;
      }
    });
  });
</script>