---
import '../styles/global.css';
import Navigation from '../components/Navigation.astro';
import { getTranslations } from '../i18n/utils';

export interface Props {
  title: string;
  description?: string;
  lang?: 'de' | 'en';
  keywords?: string;
}

const { title, description = "A beautiful single-page website with photo slider", lang = 'de', keywords } = Astro.props;
const t = getTranslations(lang);

// SEO URL helpers
const siteUrl = "https://tete-en-lair.ch";
const currentPath = Astro.url.pathname;
const canonicalUrl = new URL(currentPath, siteUrl).href;

// Compute alternate language URLs for hreflang
const getAlternateUrl = (targetLang: 'de' | 'en') => {
  let path = currentPath;
  if (targetLang === 'en') {
    // German to English: add /en prefix
    if (!path.startsWith('/en')) {
      path = path === '/' ? '/en/' : `/en${path}`;
    }
  } else {
    // English to German: remove /en prefix
    if (path.startsWith('/en')) {
      path = path.replace(/^\/en/, '') || '/';
    }
  }
  return new URL(path, siteUrl).href;
};

const deUrl = getAlternateUrl('de');
const enUrl = getAlternateUrl('en');
const ogImage = `${siteUrl}/og-image.jpg`;

// Structured Data for LocalBusiness/HairSalon
const structuredData = {
  "@context": "https://schema.org",
  "@type": "HairSalon",
  "name": "tête en l'air",
  "alternateName": lang === 'de' ? "Coiffeur tête en l'air" : "French Hair Salon tête en l'air",
  "description": lang === 'de'
    ? "Einzigartiger Friseursalon im umgebauten Flughafenbus in Basel Kleinbasel, Klybeck am Rhein beim Hafen. Französische Haarstylistin spezialisiert auf Balayage, Haare schneiden, Haarfarben und kreative Kolorationen im Holzpark."
    : "Unique hair salon in converted airport shuttle bus in Basel Kleinbasel, Klybeck by the Rhine at harbor. French hairstylist specialized in balayage, haircuts, hair coloring and creative colorations in Holzpark.",
  "url": "https://tete-en-lair.ch/",
  "telephone": "+41764747939",
  "priceRange": "CHF 30-200",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Uferstrasse 40, Holzpark Klybeck",
    "addressLocality": "Basel Kleinbasel",
    "postalCode": "4057",
    "addressCountry": "CH"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "47.5686",
    "longitude": "7.6055"
  },
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Thursday", "Friday", "Saturday"],
      "opens": "11:00",
      "closes": "20:00"
    }
  ],
  "image": "https://tete-en-lair.ch/favicon.svg",
  "sameAs": []
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords || t.seo.keywords} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalUrl} />

    <!-- Alternate Language Links (hreflang) -->
    <link rel="alternate" hreflang="de" href={deUrl} />
    <link rel="alternate" hreflang="en" href={enUrl} />
    <link rel="alternate" hreflang="x-default" href={deUrl} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content={lang === 'de' ? 'de_CH' : 'en_US'} />
    <meta property="og:locale:alternate" content={lang === 'de' ? 'en_US' : 'de_CH'} />
    <meta property="og:site_name" content="tête en l'air" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalUrl} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:ital,wght@300;400;500;600;700&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <title>{title}</title>
  </head>
  <body class="font-body gradient-bg">
    <Navigation currentLang={lang} />
    <slot />
  </body>
</html>